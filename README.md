# -_proyecto-_Imprimir_XML_JavaFX_-_Registrar_en_Oracle_19c:
# Proyecto: Imprimir XML (JavaFX) + Registrar en Oracle 19c :.

<img width="1536" height="1024" alt="image" src="https://github.com/user-attachments/assets/6a3aaab2-3a20-4699-a5f0-f8eded395ab3" />   

Este proyecto contiene las clases y archivos necesarios para: cargar un archivo XML (incluso uno grande ~2000 líneas), mostrarlo en una interfaz gráfica (JavaFX), 
imprimirlo mediante la API de impresión de JavaFX y guardar el XML en una tabla en Oracle 19c usando JDBC .

---

## Estructura sugerida (Maven):

```
XmlPrinterOracle/
├─ pom.xml
└─ src/main/java/com/example/xmlprinter/
   ├─ MainApp.java
   ├─ DBHelper.java
   └─ XmlPrinter.java

Y opcional: src/main/resources/ (para estilos si quiere)
```

---

## pom.xml (Maven)

```xml
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <groupId>com.example</groupId>
    <artifactId>xml-printer-oracle</artifactId>
    <version>1.0-SNAPSHOT</version>
    <properties>
        <maven.compiler.source>17</maven.compiler.source>
        <maven.compiler.target>17</maven.compiler.target>
        <javafx.version>21</javafx.version>
    </properties>

    <dependencies>
        <!-- JavaFX modules (si usa SDK modular, configure según su entorno) -->
        <dependency>
            <groupId>org.openjfx</groupId>
            <artifactId>javafx-controls</artifactId>
            <version>${javafx.version}</version>
        </dependency>
        <dependency>
            <groupId>org.openjfx</groupId>
            <artifactId>javafx-graphics</artifactId>
            <version>${javafx.version}</version>
        </dependency>

        <!-- Nota: el driver Oracle JDBC usualmente no está en Maven Central.
             Puede descargar ojdbc JAR de Oracle y agregarlo como dependencia local
             o instalarlo en su repositorio local. Aquí dejamos comentario.
        -->
        <!--
        <dependency>
            <groupId>com.oracle.database.jdbc</groupId>
            <artifactId>ojdbc10</artifactId>
            <version>19.14.0.0</version>
        </dependency>
        -->

    </dependencies>

    <build>
        <plugins>
            <!-- Shade u otro plugin si necesita fat-jar -->
        </plugins>
    </build>
</project>
```

**Importante:** si no añade el driver ojdbc al pom, en IntelliJ puede añadir manualmente el JAR (ojdbc8.jar u ojdbc10.jar) en "Project Structure -> Libraries" o instalarlo en el repositorio local con `mvn install:install-file` .

---

## SQL - Crear tabla en Oracle 19c:

```sql
CREATE TABLE xml_store (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    filename VARCHAR2(255),
    uploaded_by VARCHAR2(100),
    uploaded_at TIMESTAMP DEFAULT SYSTIMESTAMP,
    xml_content CLOB
);

-- Privilegios: asegúrese de que el usuario tenga INSERT/SELECT en la tabla
```

---

## Código Java:

### MainApp.java (JavaFX principal)

```java
package com.example.xmlprinter;

import javafx.application.Application;
import javafx.geometry.Insets;
import javafx.scene.Scene;
import javafx.scene.control.*;
import javafx.scene.layout.BorderPane;
import javafx.scene.layout.HBox;
import javafx.stage.FileChooser;
import javafx.stage.Stage;

import java.io.File;
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;

public class MainApp extends Application {

    private TextArea xmlArea;
    private Label statusLabel;
    private File currentFile;

    @Override
    public void start(Stage primaryStage) {
        primaryStage.setTitle("Imprimir XML y Guardar en Oracle 19c");

        xmlArea = new TextArea();
        xmlArea.setWrapText(false);
        xmlArea.setPrefRowCount(40);
        xmlArea.setPrefColumnCount(120);

        Button btnOpen = new Button("Abrir XML");
        Button btnPrint = new Button("Imprimir");
        Button btnSaveDb = new Button("Guardar en BD (Oracle)");

        btnOpen.setOnAction(e -> openXml(primaryStage));
        btnPrint.setOnAction(e -> XmlPrinter.printNode(xmlArea));
        btnSaveDb.setOnAction(e -> saveToDatabase());

        HBox controls = new HBox(10, btnOpen, btnPrint, btnSaveDb);
        controls.setPadding(new Insets(10));

        statusLabel = new Label("Listo");
        BorderPane root = new BorderPane();
        root.setTop(controls);
        root.setCenter(xmlArea);
        root.setBottom(statusLabel);
        BorderPane.setMargin(xmlArea, new Insets(10));

        Scene scene = new Scene(root, 1000, 700);
        primaryStage.setScene(scene);
        primaryStage.show();
    }

    private void openXml(Stage stage) {
        FileChooser chooser = new FileChooser();
        chooser.getExtensionFilters().add(new FileChooser.ExtensionFilter("XML Files", "*.xml"));
        File file = chooser.showOpenDialog(stage);
        if (file != null) {
            try {
                String content = Files.readString(Path.of(file.toURI()));
                xmlArea.setText(content);
                currentFile = file;
                statusLabel.setText("Archivo cargado: " + file.getName());
            } catch (IOException ex) {
                statusLabel.setText("Error al leer archivo: " + ex.getMessage());
                ex.printStackTrace();
            }
        }
    }

    private void saveToDatabase() {
        String xml = xmlArea.getText();
        if (xml == null || xml.isEmpty()) {
            statusLabel.setText("No hay XML para guardar.");
            return;
        }

        statusLabel.setText("Guardando en BD...");
        try {
            // Cambie los parámetros de conexión en DBHelper
            DBHelper db = new DBHelper();
            db.insertXml(currentFile != null ? currentFile.getName() : "sin_nombre.xml", "usuario_app", xml);
            statusLabel.setText("Guardado correctamente en la BD.");
        } catch (Exception ex) {
            statusLabel.setText("Error al guardar en BD: " + ex.getMessage());
            ex.printStackTrace();
        }
    }

    public static void main(String[] args) {
        launch(args);
    }
}
```


### XmlPrinter.java (utilidad de impresión)

```java
package com.example.xmlprinter;

import javafx.print.PageLayout;
import javafx.print.Printer;
import javafx.print.PrinterJob;
import javafx.scene.Node;
import javafx.scene.control.TextArea;
import javafx.scene.transform.Scale;

public class XmlPrinter {

    /**
     * Imprime el contenido del TextArea usando PrinterJob de JavaFX.
     */
    public static void printNode(TextArea textArea) {
        Printer printer = Printer.getDefaultPrinter();
        if (printer == null) {
            System.err.println("No hay impresora por defecto disponible.");
            return;
        }

        PrinterJob job = PrinterJob.createPrinterJob();
        if (job == null) {
            System.err.println("No se pudo crear PrinterJob.");
            return;
        }

        boolean proceed = job.showPrintDialog(textArea.getScene().getWindow());
        if (!proceed) {
            return;
        }

        PageLayout pl = job.getJobSettings().getPageLayout();

        // Escalado simple para ajustar el contenido si es necesario
        double scaleX = pl.getPrintableWidth() / textArea.getWidth();
        double scaleY = pl.getPrintableHeight() / textArea.getHeight();
        double scale = Math.min(scaleX, scaleY);
        if (scale <= 0) scale = 1.0;

        Scale st = new Scale(scale, scale);
        textArea.getTransforms().add(st);

        boolean success = job.printPage(textArea);

        textArea.getTransforms().remove(st);

        if (success) {
            job.endJob();
            System.out.println("Impresión enviada correctamente.");
        } else {
            System.err.println("Falló la impresión.");
        }
    }
}
```


### DBHelper.java (conexión a Oracle y guardado)

```java
package com.example.xmlprinter;

import java.io.StringReader;
import java.sql.*;

public class DBHelper {

    // EDITAR: coloque aquí los datos reales de su conexión Oracle
    private static final String JDBC_URL = "jdbc:oracle:thin:@//HOST:PORT/SERVICE";
    private static final String DB_USER = "mi_usuario";
    private static final String DB_PASSWORD = "mi_password";

    public DBHelper() throws ClassNotFoundException {
        // Cargar driver (opcional en Java 8+ si el driver está en el classpath)
        // Class.forName("oracle.jdbc.driver.OracleDriver");
    }

    public void insertXml(String filename, String uploadedBy, String xmlContent) throws SQLException {
        String sql = "INSERT INTO xml_store (filename, uploaded_by, xml_content) VALUES (?, ?, ?)";

        try (Connection conn = DriverManager.getConnection(JDBC_URL, DB_USER, DB_PASSWORD)) {
            conn.setAutoCommit(false);
            try (PreparedStatement pstmt = conn.prepareStatement(sql)) {
                pstmt.setString(1, filename);
                pstmt.setString(2, uploadedBy);

                // Para CLOB grande, usar setCharacterStream
                StringReader reader = new StringReader(xmlContent);
                pstmt.setCharacterStream(3, reader, xmlContent.length());

                pstmt.executeUpdate();
                conn.commit();
            } catch (SQLException ex) {
                conn.rollback();
                throw ex;
            }
        }
    }
}
```

---

## Notas de configuración y ejecución (IntelliJ):

1. Cree un proyecto Maven en IntelliJ y copie `pom.xml` y las clases en el paquete `com.example.xmlprinter`.
2. Añada el JAR del driver Oracle (ojdbc8.jar u ojdbc10.jar) a las libraries del proyecto si no lo instala en Maven.
   - IntelliJ: File -> Project Structure -> Libraries -> + -> seleccione el JAR.
   - O instale con `mvn install:install-file -Dfile=/path/ojdbc8.jar -DgroupId=com.oracle -DartifactId=ojdbc8 -Dversion=19.3 -Dpackaging=jar`
3. Modifique `DBHelper.JDBC_URL`, `DB_USER` y `DB_PASSWORD` con sus credenciales y host/puerto/service.
   - formato ejemplo: `jdbc:oracle:thin:@//192.168.1.100:1521/XEPDB1`
4. Asegúrese que el usuario Oracle tenga permisos para INSERT en la tabla `xml_store`.
5. Ejecutar `MainApp` desde IntelliJ (ejecutar la clase MainApp). Si usa JavaFX modular, agregue VM options apropiadas, p. ej.:
   - `--module-path "C:\path\to\javafx-sdk-21\lib" --add-modules javafx.controls,javafx.graphics`
6. Abra un XML con "Abrir XML", revise en el TextArea y pulse "Imprimir" o "Guardar en BD (Oracle)".

---

## Consideraciones y mejoras posibles:

- Si desea almacenar metadatos adicionales (por ejemplo tamaño, hash, validación XSD), añadalos a la tabla.
- Para XML muy grandes (varios MB) considere enviar el CLOB vía `oracle.sql.CLOB` APIs o usar streaming.
- Para guardar nodos individuales del XML en tablas relacionales, puede parsear el XML con `javax.xml.parsers.DocumentBuilder` o `StAX` y hacer inserts por nodo.
- Para manejar 2000 líneas no hay problema: se muestra en TextArea, pero la experiencia de usuario puede mejorar con paginación o viewer con resaltado de sintaxis.

--- :. .
